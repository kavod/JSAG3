<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<link rel="icon" href="data:;base64,iVBORw0KGgo=">
	<title>jsonConfigParser</title>
	<!-- You MUST load JQuery script (from https://jquery.com/ ) -->
	<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
	<!-- You MUST load "JQuery serialize object" script (from Macek https://github.com/macek/jquery-serialize-object ) -->
	<script src="js/jquery.serialize-object.min.js"></script>
	<!-- Here the JCP script -->
	<script src="js/jcp.js"></script>
	<script>
		$( document ).ready(function() {
			// Get the schema data
			$.getJSON( 'config.jschem', function( data ) {
				var schema = data;
				// Get the data contents
				$.getJSON( 'data', function( data ) {
					// create form in <body> the node element
					myForm = jcp.create_form($('body'),'conf',schema,data);
					console.log(myForm);
					myForm.on('submit',function(event) {
						event.preventDefault();
						
						//data = $(this).serializeObject();
						// Workaround for bug https://github.com/macek/jquery-serialize-object/issues/33
    					var formSerializer = new FormSerializer($, $(this));
						var pairs = $(this).serializeArray();
						var results = $(this).find(':checkbox:not(:checked)').clone().prop('checked', true).serializeArray();
						for (var i = 0; i < results.length; i++) 
							results[i].value = results[i].value === "true";
						pairs = pairs.concat(results);

						data = formSerializer.addPairs(pairs).serialize();

						console.log('The following data has been submit to /jcp/submit');
						console.log(data);
						$.ajax({
							'url': '/',
							'type':'POST',
							'dataType':'json',
							'data':JSON.stringify(data),
							'contentType': 'application/json; charset=UTF-8',
		 					'processData': false,
		 					cache:false,
							})
							.done(function(data) {
		 						console.log("Server response:");
		 						console.log(data);
		 					});
				
						}
					);
					
				});
			});
		});
	</script>
</head>
<body>
</body>
</html>
